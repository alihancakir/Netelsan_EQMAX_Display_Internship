#include <stdio.h>
#include <stdbool.h>
#include <unistd.h>
#include <freertos/FreeRTOS.h>
#include "i2c.h"
#include "disp_driver.h"
#include "soc/gpio_num.h"
#include "driver/gpio.h"
#include "qr_font.h"


#define BUTTON_1   GPIO_NUM_27 
#define BUTTON_2   GPIO_NUM_26 
#define BUTTON_3   GPIO_NUM_25 

bool flag1=0;
bool flag2=0;
bool flag3=0;

	/*
	1-i2c_init();					:i2c init
	2-connect_display();			:connect to dislay
	3-disp_osd_block_state()		:open block x
	4-disp_osd_config()				:get config(mix,color select) 
	5-size and pos
	6-index settings
	*/

void app_main(void)
{

	gpio_reset_pin(BUTTON_1);
    gpio_set_direction(BUTTON_1, GPIO_MODE_INPUT);
    gpio_pulldown_en(GPIO_NUM_27);
    
    gpio_reset_pin(BUTTON_2);
    gpio_set_direction(BUTTON_2, GPIO_MODE_INPUT);
    gpio_pulldown_en(GPIO_NUM_26);
    
    gpio_reset_pin(BUTTON_3);
    gpio_set_direction(BUTTON_3, GPIO_MODE_INPUT);
    gpio_pulldown_en(GPIO_NUM_25);

	vTaskDelay(pdMS_TO_TICKS(2000));
	i2c_init();
	connect_display();
	printf("connected\n");
	while (1) {
		bool button_1_state = gpio_get_level(BUTTON_1); 
        bool button_2_state = gpio_get_level(BUTTON_2); 
        bool button_3_state = gpio_get_level(BUTTON_3); 	
        
        
//----------------------------------------------------------------------------------------------------------------------------------------------------------	
        //MENU 
        if (button_1_state == 1 && flag1==0) { 
			 flag1=1;  } 
    	if(flag1==1 && button_1_state==0){
			
			//i2c_init();
			//connect_display();
			

			disp_osd_block_state(0, 1);	//osd block 0 opened
			disp_osd_config();
			disp_osd_fore_color_select(1);
			
			printf("color white");
			write_byte(0xB4,0xD2,0x15);  // color: white
			
			disp_osd_block0_menu();
			//vTaskDelay(pdMS_TO_TICKS(500));
			//vTaskDelay(pdMS_TO_TICKS(50));
			
			/*uint16_t info_1[]={Q,R,SPACE,C,O,D,E,SPACE,T,E,S,T,END};	
			show_string(1,2,info_1);	
			
			uint16_t info_2[]={T,E,S,T,SPACE,K,I,T,SPACE,V,N_1,DOT,N_1,END};	
			show_string(2,2,info_2);
	
			uint16_t info_3[]={P,R,E,S,SPACE,B,U,T,T,O,N,SPACE,N_2,END};	
			show_string(3,2,info_3);*/
			vTaskDelay(pdMS_TO_TICKS(2000));
			printf("ready!\n");
			
			//show_qr();
			//show_external_font();
			//show_custom_font();
			
			//1.1
uint8_t QR11_BM[] =
{0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0x00, 0xF0, 0x00, 0xF0, 0x00, 0xF0, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF0, 0x00, 0xF0, 0x00, 0xF0, 0x00, 0xF8, 0x00};

//1.2
uint8_t QR12_BM[] =
{0xFF, 0xC7, 0xFF, 0xC7, 0xFF, 0xC7, 0xFF, 0xC7, 0x03, 0xC7, 0x03, 0xC7, 0x03, 0xC7, 0xC3, 0xC7, 0xC3, 0xC7, 0xC3, 0xC7, 0xC3, 0xC7, 0xC3, 0xC0, 0xC3, 0xC0, 0xC3, 0xC0, 0xC3, 0xC0, 0xC3, 0xC0, 0xC3, 0xC0, 0xC3, 0xC0, 0x03, 0xC7, 0x03, 0xC7, 0x03, 0xC7, 0x07, 0xC7};

//1.3
uint8_t QR13_BM[] =
{0x80, 0xFF, 0x80, 0xFF, 0x80, 0xFF, 0x81, 0xFF, 0x8F, 0xF0, 0x8F, 0xF0, 0x8F, 0xF0, 0x81, 0xF1, 0x80, 0xF1, 0x80, 0xF1, 0x80, 0xF1, 0x0F, 0xFF, 0x0F, 0xFF, 0x0F, 0xFF, 0x0F, 0xFF, 0x0F, 0x00, 0x0F, 0x00, 0x0F, 0x00, 0x81, 0xF1, 0x80, 0xF1, 0x80, 0xF1, 0x85, 0xF3};

//1.4
uint8_t QR14_BM[] =
{0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0x00, 0x3C, 0x00, 0x3C, 0x00, 0x3C, 0xFF, 0xC0, 0xFF, 0xC0, 0xFF, 0xC0, 0xFF, 0xC0, 0xE0, 0x3C, 0xE0, 0x3C, 0xE0, 0x3C, 0xFC, 0x3F, 0x1C, 0x3F, 0x1C, 0x3F, 0x3C, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};

//1.5
uint8_t QR15_BM[] =
{0x8F, 0x00, 0x8F, 0x00, 0x8F, 0x00, 0x8F, 0x80, 0x78, 0xF0, 0x78, 0xF0, 0x78, 0xF0, 0x0F, 0x9F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0xFF, 0x0F, 0xFE, 0x0F, 0xFE, 0xFF, 0xFF, 0xF8, 0xF1, 0xF8, 0xF1, 0xF8, 0xF1, 0x8F, 0x9F, 0x8F, 0x0F, 0x8F, 0x0F, 0xCF, 0x9F};

//1.6
uint8_t QR16_BM[] =
{0x1E, 0x00, 0x1E, 0x00, 0x1E, 0x00, 0x1E, 0x00, 0x00, 0x3C, 0x00, 0x3C, 0x00, 0x3C, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x3F, 0x00, 0x3F, 0x00, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE0, 0x07, 0xE0, 0x03, 0xE0, 0x03, 0xE1, 0x03};

//1.7
uint8_t QR17_BM[] =
{0x07, 0x8F, 0x07, 0x8F, 0x07, 0x8F, 0x07, 0x9F, 0x00, 0xF0, 0x00, 0xF0, 0x00, 0xF0, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0xC0, 0x00, 0xF8, 0xFF, 0xF8, 0xFF, 0xF8, 0xFF, 0xF8, 0x7F, 0x80, 0x0F, 0x80, 0x0F, 0x80, 0x0F, 0x80, 0xF0, 0x80, 0xF0, 0x80, 0xF0, 0x80, 0xFA};

//1.8
uint8_t QR18_BM[] =
{0x1E, 0x03, 0x1E, 0x03, 0x1E, 0x03, 0x1E, 0x07, 0xFE, 0x3F, 0xFE, 0x3F, 0xFE, 0x3F, 0x00, 0x3F, 0x00, 0x3F, 0x00, 0x3F, 0x00, 0x3F, 0xE1, 0xFF, 0xE1, 0xFF, 0xE1, 0xFF, 0xE1, 0xFF, 0xE1, 0xE3, 0xE1, 0xE3, 0xE1, 0xE3, 0x1F, 0xFF, 0x1F, 0xFF, 0x1F, 0xFF, 0x1F, 0xFF};

//1.9
uint8_t QR19_BM[] =
{0xC7, 0x80, 0xC7, 0x80, 0xC7, 0x80, 0xC7, 0x81, 0xC7, 0xFF, 0xC7, 0xFF, 0xC7, 0xFF, 0xC0, 0x0F, 0xC0, 0x0F, 0xC0, 0x0F, 0xC0, 0x0F, 0xFF, 0x8F, 0xFF, 0x8F, 0xFF, 0x8F, 0xFF, 0x87, 0xFF, 0x80, 0xFF, 0x80, 0xFF, 0x80, 0xFF, 0xF8, 0xFF, 0xF8, 0xFF, 0xF8, 0xFF, 0xF8};

//1.10
uint8_t QR110_BM[] =
{0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xE0, 0xF1, 0xE0, 0xF1, 0xE0, 0xF1, 0xE3, 0xF1, 0xE3, 0xF1, 0xE3, 0xF1, 0xE3, 0x01, 0xE3, 0x01, 0xE3, 0x01, 0xE3, 0x01, 0xE3, 0x01, 0xE3, 0x01, 0xE3, 0x01, 0xE3, 0x01, 0xE0, 0x01, 0xE0, 0x01, 0xE0, 0x21, 0xF0};

//1.11
uint8_t QR111_BM[] =
{0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x07, 0x00, 0x07, 0x00, 0x07, 0xFF, 0x87, 0xFF, 0x87, 0xFF, 0x87, 0xFF, 0x87, 0xFF, 0x87, 0xFF, 0x87, 0xFF, 0x87, 0xFF, 0x87, 0xFF, 0x87, 0xFF, 0x87, 0xFF, 0x87, 0x00, 0x07, 0x00, 0x07, 0x00, 0x07, 0x00, 0x0F};

//2.1
uint8_t QR21_BM[] =
{0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0x01, 0xFF, 0x01, 0xFF, 0x01, 0xFF, 0x01, 0xE1, 0x01, 0xE1, 0x01, 0xE3, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF9, 0xFF, 0x0F, 0xE0, 0x0F, 0xE0, 0x0F, 0xE0, 0x01, 0xE0};

//2.2
uint8_t QR22_BM[] =
{0xFF, 0xC7, 0xFF, 0xC7, 0xFF, 0xC7, 0x00, 0x07, 0x00, 0x07, 0x00, 0x07, 0x00, 0x07, 0xC3, 0xC7, 0xC3, 0xC7, 0xC3, 0xC7, 0xFF, 0xFF, 0xFC, 0x78, 0xFC, 0x78, 0xFC, 0x78, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x3C, 0x78, 0x3C, 0x78, 0x3C, 0x78, 0x07, 0xC0};
/*
//2.3
uint8_t QR23_BM[] =
{0x8F, 0x1E, 0x8F, 0x1E, 0x8F, 0x1E, 0x80, 0x1E, 0x80, 0x1E, 0x80, 0x1E, 0x80, 0x1E, 0x8F, 0xF0, 0x8F, 0xF0, 0x8F, 0xF0, 0x07, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF3, 0x70, 0xFE, 0x70, 0xFE, 0x70, 0xFE, 0x7F, 0x1E};

//2.4
uint8_t QR24_BM[] =
{0x1C, 0x38, 0x1C, 0x38, 0x1C, 0x3C, 0x1F, 0xC7, 0x1F, 0xC7, 0x1F, 0xC7, 0x1F, 0xC7, 0x00, 0x3F, 0x00, 0x3F, 0x00, 0x3F, 0xC3, 0xFF, 0xE3, 0xFF, 0xE3, 0xFF, 0xE3, 0xFF, 0xE0, 0x7C, 0xE0, 0x38, 0xE0, 0x3C, 0xE0, 0x3C, 0x00, 0x07, 0x00, 0x07, 0x00, 0x07, 0x1F, 0xC7};

//2.5
uint8_t QR25_BM[] =
{0x78, 0xF1, 0x78, 0xF1, 0x78, 0xF1, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x8F, 0xF1, 0x8F, 0xF1, 0x8F, 0xF1, 0xFF, 0xFF, 0xF8, 0xFE, 0xF8, 0xFE, 0xF8, 0xFF, 0x0F, 0xF1, 0x0F, 0xF1, 0x0F, 0xF1, 0x0F, 0xF0, 0xF8, 0x00, 0xF8, 0x00, 0xF8, 0x00, 0xFF, 0x0E};

//2.6
uint8_t QR26_BM[] =
{0xE3, 0xC3, 0xE3, 0xC3, 0xE3, 0xC3, 0xE0, 0x03, 0xE0, 0x03, 0xE0, 0x03, 0xE0, 0x07, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x3F, 0x00, 0x3F, 0x00, 0x3F, 0xE3, 0xFC, 0xE3, 0xFC, 0xE3, 0xFC, 0xF3, 0xFE, 0x1F, 0xFF, 0x1F, 0xFF, 0x1F, 0xFF, 0x03, 0xFC};

//2.7
uint8_t QR27_BM[] =
{0x87, 0x8F, 0x87, 0x8F, 0x87, 0x8F, 0x80, 0x01, 0x80, 0x00, 0x80, 0x00, 0xC0, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF8, 0x0F, 0xF8, 0x0F, 0xF8, 0x0F, 0x7F, 0xF1, 0x7F, 0xF0, 0x7F, 0xF0, 0x7F, 0xF0, 0x87, 0x80, 0x87, 0x80, 0x87, 0x80, 0x00, 0xFF};

//2.8
uint8_t QR28_BM[] =
{0x1E, 0x3C, 0x1E, 0x3C, 0x1E, 0x3C, 0xFE, 0x00, 0xFE, 0x00, 0xFE, 0x00, 0xFE, 0x00, 0x00, 0x03, 0x00, 0x03, 0x00, 0x03, 0xE0, 0x03, 0xE0, 0x00, 0xE0, 0x00, 0xE0, 0x00, 0xE1, 0xFF, 0xE1, 0xFF, 0xE1, 0xFF, 0xE1, 0xFF, 0xE0, 0x3C, 0xE0, 0x3C, 0xE0, 0x3C, 0xFE, 0x03};

//2.9
uint8_t QR29_BM[] =
{0x38, 0x78, 0x38, 0x78, 0x38, 0x78, 0x3F, 0xFF, 0x3F, 0xFF, 0x3F, 0xFF, 0x7F, 0xFF, 0xC7, 0x8F, 0xC7, 0x8F, 0xC7, 0x8F, 0x87, 0x8F, 0x07, 0x8F, 0x07, 0x8F, 0x07, 0x8F, 0xC0, 0x78, 0xC0, 0x78, 0xC0, 0x78, 0xC2, 0xF0, 0x07, 0x80, 0x07, 0x80, 0x07, 0x80, 0xFC, 0x0F};

//2.10
uint8_t QR210_BM[] =
{0xF1, 0xFF, 0xF1, 0xFF, 0xF1, 0xFF, 0xF0, 0x00, 0xF0, 0x00, 0xF0, 0x00, 0xF0, 0x00, 0xFF, 0xFE, 0xFF, 0xFE, 0xFF, 0xFE, 0xFF, 0xFF, 0x0F, 0xFF, 0x0F, 0xFF, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x01, 0xF0, 0x03, 0xF0, 0x03, 0xF0, 0x03, 0xFF, 0xFE};

//2.11
uint8_t QR211_BM[] =
{0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xFF, 0x07, 0xFF, 0x07, 0xFF, 0xC7, 0xFF, 0xC7, 0x80, 0xC3, 0x80, 0xC7, 0x80, 0x3C, 0x7F, 0x3C, 0x7F, 0x3C, 0x7F, 0x78, 0x7F, 0xC0, 0x07, 0xC0, 0x07, 0xC0, 0x07, 0x03, 0xFF};
*/
			
			
	
			load_costum_font_ram(0,QR11_BM);
			load_costum_font_ram(1,QR12_BM);
			load_costum_font_ram(2,QR13_BM);
			load_costum_font_ram(3,QR14_BM);
			load_costum_font_ram(4,QR15_BM);
			load_costum_font_ram(5,QR16_BM);
			load_costum_font_ram(6,QR17_BM);
			load_costum_font_ram(7,QR18_BM);
			load_costum_font_ram(8,QR19_BM);
			load_costum_font_ram(9,QR110_BM);
			load_costum_font_ram(10,QR111_BM);
			//load_costum_font_ram(11,QR21_BM);
			//load_costum_font_ram(12,QR22_BM);
			/*load_costum_font_ram(13,QR23_BM);
			load_costum_font_ram(14,QR24_BM);
			load_costum_font_ram(15,QR25_BM);
			load_costum_font_ram(16,QR26_BM);
			load_costum_font_ram(17,QR27_BM);
			load_costum_font_ram(18,QR28_BM);
			load_costum_font_ram(19,QR29_BM);
			load_costum_font_ram(20,QR210_BM);
			load_costum_font_ram(21,QR211_BM);*/
			
			
			show_char(36,QR11);
			show_char(37,QR12);
			show_char(38,QR13);
			show_char(39,QR14);
			show_char(40,QR15);
			show_char(41,QR16);
			show_char(42,QR17);
			show_char(43,QR18);
			show_char(44,QR19);
			show_char(45,QR111);
			show_char(46,QR112);
			//show_char(68,QR21);
			//show_char(69,QR22);
			/*show_char(73,QR23);
			show_char(74,QR24);
			show_char(75,QR25);
			show_char(76,QR26);
			show_char(77,QR27);
			show_char(78,QR28);
			show_char(79,QR29);
			show_char(80,QR211);
			show_char(81,QR212);*/
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			/*load_costum_font_ram(0,QR_CHAR);
			uint16_t info_3[]={QR11,END};
			show_string(2, 5, info_3);
			
			load_costum_font_ram(1,QR_CHAR_1);
			uint16_t info_4[]={QR12,END};
			show_string(2, 6, info_4);*/
			/*
			vTaskDelay(pdMS_TO_TICKS(2000));
			show_string(3, 5, info_3);			
			vTaskDelay(pdMS_TO_TICKS(2000));
			show_string(4, 5, info_3);
			vTaskDelay(pdMS_TO_TICKS(2000));
			show_string(5, 5, info_3);*/
			
			
			flag1=0;
		}
//-------------------------------------------------		
        if (button_2_state == 1 && flag2==0) { 
			 flag2=1;
	
        } 
        if(flag2==1 && button_2_state==0){
				

			flag2=0;
		}		
//-------------------------------------------------
        
        //BACK VIDEO
        if (button_3_state == 1 && flag3==0) { 
			 flag3=1;
	
        } 
        if(flag3==1 && button_3_state==0){
			
			disp_osd_block_state(0, 0);
			printf("back video");
			write_byte(0xB4,0xD2,0x4F);  // color: no
			//write_byte(0xB0, 0x00,0x5A);
			flag3=0;
			//esp_restart();
		}		

		vTaskDelay(pdMS_TO_TICKS(100));		
	
	}
}